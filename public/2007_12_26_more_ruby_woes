<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>More Ruby Woes &mdash; Christopher Swenson</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
	<link href="feed" rel="alternate" title="Primary Feed" type="application/atom+xml" />

	<link href="SyntaxHighlighter.css" rel="stylesheet" type="text/css" />
	<script src="js/shCore.js" type="text/javascript"></script>
	<script src="js/shBrushRuby.js" type="text/javascript"></script>
	<script src="js/shBrushPython.js" type="text/javascript"></script>

	<script language="javascript">
	window.onload = function () {
	    dp.SyntaxHighlighter.ClipboardSwf = '/flash/clipboard.swf';
	    dp.SyntaxHighlighter.HighlightAll('code');
	}
	</script>

</head>
<body>
<div id="wrap">

<div id="sidebar">

	<div id="cs">
		<span id="c">
			C
		</span>
		<span id="s">
			S
		</span>
	</div>

	<img id="pic" src="images/purple-top-hat.jpg" alt="purple top hat" />

	<div class="side">
		<ul>
	    <li><a href="about">About</a></li>
			<li><a href="contact">Contact</a></li>
	    <li><a href="speaking">Speaking</a></li>
			<li><a href="http://mathgineering.com">Consulting</a></li>
		</ul>
	</div>

	<hr />

	<div class="side">
		<ul>
			<li><a href="http://github.com/swenson">GitHub</a></li>
			<li><a href="http://twitter.com/chris_swenson">Twitter</a></li>
			<li><a href="https://plus.google.com/+ChristopherSwenson">Google+</a></li>
			<li><a href="http://www.linkedin.com/in/christopherswenson/">LinkedIn</a></li>
		</ul>
	</div>

	<hr />

	<div class="side">
		<ul>
			<li><a href="archive">Blog Archive</a></li>
			<li><a href="mc">Modern Cryptanalysis</a></li>
			<li><a href="https://artisanalcrypto.com">Artisinal Crypto</a></li>
			<!--<li>Open Source Bounty</li>-->
		</ul>
	</div>
</div>

<div id="main">
	<div class="tagline">computer science, math, programming and other stuff</div>
	<div class="tagline">a blog by Christopher Swenson</div>

	<div class="postzoom"><h1><a href="2007_12_26_more_ruby_woes">More Ruby Woes</a></h1>
<p>I have been giving Ruby the old college try.  I was running into some strange difficulties with a minimax function in Ruby that at first I thought were more scoping oddities.</p>

<p>It turns out that the <code>clone</code> and <code>dup</code> operators on Arrays in Ruby only perform shallow copying, which will pretty much not work on multidimensional arrays.  Oh well, I guess I would have to write my own, or copy someone else's, right?  Maybe something like:</p>

<pre lang="ruby">def deepcopy(x)
  if x.kind_of? Array
    copy = []
    x.each { |y|  copy += [deepcopy(y)] }
    return copy
  else
    return x.dup
  end
end</pre>

<p><strong>Wrong</strong>.  Ruby's almost-but-not-quite pure-OO nature actually makes it nearly impossible to create a generic deep copy function.  The problem is that integers, floats, and so forth are not the complete objects we thought they were, because you can't <code>dup</code> them:</p>

<pre>>> x = 1.dup
TypeError: can't dup Fixnum
    from (irb):1:in `dup'
    from (irb):1</pre>

<p>So much for pure OO.</p>

<p>The best solution I could come up with for a two-deep copy is (knowing ahead of time that it is a matrix):</p>

<pre lang="ruby">def copy2(b)
    newb = []
    b.each { |r|  newb += [r.dup] }
    return newb
end</pre>

<p>This, along with the odd scoping rules and counter-intuitive syntax are making me seriously consider ending my Ruby experiment.  And I so wanted to love Ruby.</p>
</div>
	

</div>

<div id="clear"></div>

<div id="footer">
	<p id="legal">
		Copyright 2014 Christopher Swenson
	</p>
</div>

</div>
</body>
</html>
